// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// 품목 마스터
model Item {
  id          Int      @id @default(autoincrement())
  code        String   @unique
  name        String
  unit        String   // 개, BOX, kg 등
  note        String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  lots        InventoryLot[]
  movements   InventoryMovement[]
}

// LOT/입고 관리
model InventoryLot {
  id                Int      @id @default(autoincrement())
  itemId            Int
  item              Item     @relation(fields: [itemId], references: [id])
  lotCode           String?  // BL번호, 참조번호 등
  receivedDate      DateTime
  quantityReceived  Float    // 입고 수량
  quantityRemaining Float    // 현재 잔량
  
  goodsAmount       Float    // 물품대금
  dutyAmount        Float    // 수입통관료
  domesticFreight   Float    // 국내 입고운송료
  otherCost         Float    @default(0) // 기타 비용
  unitCost          Float    // 단가 (자동계산)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  movements         InventoryMovement[]
}

// 입출고 이력
model InventoryMovement {
  id           Int      @id @default(autoincrement())
  movementDate DateTime
  itemId       Int
  item         Item     @relation(fields: [itemId], references: [id])
  lotId        Int?
  lot          InventoryLot? @relation(fields: [lotId], references: [id])
  type         String   // IN, OUT, ADJUST
  quantity     Float
  unitCost     Float
  totalCost    Float    // quantity * unitCost
  
  refType      String?  // 참조 타입
  refId        String?  // 참조 ID
  
  createdAt    DateTime @default(now())
}

// 창고료/기간비용
model StorageExpense {
  id          Int      @id @default(autoincrement())
  period      String   // '2026-02' 형태
  dateFrom    DateTime
  dateTo      DateTime
  warehouseId Int?     // 추후 확장용
  amount      Float
  memo        String?
  
  createdAt   DateTime @default(now())
}

// 판매 담당자
model Salesperson {
  id             Int           @id @default(autoincrement())
  code           String        @unique  // BS, IK, YR, SJ
  name           String
  commissionRate Float         @default(0)  // IK만 0.15
  sales          SalesRecord[]
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
}

// 품목 카테고리
model ProductCategory {
  id        Int           @id @default(autoincrement())
  code      String        @unique
  name      String        // Machine, Parts, Fount 등
  nameKo    String        // 기계, 부품, 약물및습수액 등
  sales     SalesRecord[]
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
}

// 매입매출 기록
model SalesRecord {
  id            Int             @id @default(autoincrement())
  date          DateTime
  type          String          // PURCHASE(매입) or SALES(매출)
  salespersonId Int
  salesperson   Salesperson     @relation(fields: [salespersonId], references: [id])
  categoryId    Int
  category      ProductCategory @relation(fields: [categoryId], references: [id])
  itemName      String
  customer      String?
  quantity      Float
  unitPrice     Float
  amount        Float           // 수량 * 단가
  cost          Float           @default(0) // 원가 (매출 시)
  margin        Float           @default(0) // 마진 = amount - cost
  marginRate    Float           @default(0) // 마진율
  notes         String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
}
